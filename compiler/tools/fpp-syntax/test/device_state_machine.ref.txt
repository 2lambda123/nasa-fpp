@ Fault data
def struct
  ident FaultData
  struct type member
    ident id
    type name U32
  struct type member
    ident data
    type name U32
@ Power data
def struct
  ident PowerData
  struct type member
    ident level
    type name F32
@ Device state machine
def state machine
  ident Device
  @ RTI signal
  def signal
    ident RTI
  @ Complete signal
  def signal
    ident Complete
  @ Calibrate signal
  def signal
    ident Calibrate
  @ Fault signal
  def signal
    ident Fault
    typeName qual ident FaultData
  @ Drive signal
  def signal
    ident Drive
  @ Stop signal
  def signal
    ident Stop
  @ Resume signal
  def signal
    ident Resume
  @ POR signal
  def signal
    ident POR
  @ Power on signal
  def signal
    ident PowerOn
    typeName qual ident PowerData
  @ Power off signal
  def signal
    ident PowerOff
  @ Action a1
  def action
    ident a1
  @ Action init1
  def action
    ident init1
  @ Action init2
  def action
    ident init2
  @ Action set power
  def action
    ident setPower
    typeName qual ident PowerData
  @ Action init power
  def action
    ident initPower
  @ Action report fault
  def action
    ident reportFault
    typeName qual ident FaultData
  @ Action motor control
  def action
    ident motorControl
  @ Action do calibrate
  def action
    ident doCalibrate
  @ Action do safe
  def action
    ident doSafe
  @ Action do diagnostics
  def action
    ident doDiagnostics
  @ Cold start guard
  def guard
    ident coldStart
  @ No recovery guard
  def guard
    ident noRecovery
    typeName qual ident FaultData
  @ Calibrate ready guard
  def guard
    ident calibrateReady
  @ Initial transition
  spec initial
    action ident init1
    state qual ident j1
  @ Junction j1
  def junction
    ident j1
    guard ident coldStart
    action ident a1
    state qual ident DEVICE_OFF
    action ident initPower
    state qual ident DEVICE_ON
  @ DEVICE_OFF state
  def state
    ident DEVICE_OFF
    @ Transition to DEVICE_ON
    spec transition
      signal ident PowerOn
      action ident setPower
      state qual ident DEVICE_ON
  @ DEVICE_ON state
  def state
    ident DEVICE_ON
    @ Initial transition
    spec initial
      action ident init2
      state qual ident INITIALIZING
    @ INITIALIZING state
    def state
      ident INITIALIZING
      @ Transition to IDLE
      spec transition
        signal ident Complete
        state qual ident IDLE
    @ IDLE state
    def state
      ident IDLE
      @ Transition to DRIVING
      spec transition
        signal ident Drive
        state qual ident DRIVING
      @ Transition to CALIBRATING
      spec transition
        signal ident Calibrate
        guard ident calibrateReady
        state qual ident CALIBRATING
    @ CALIBRATING state
    def state
      ident CALIBRATING
      @ Internal transition
      spec transition
        signal ident RTI
        action ident doCalibrate
      @ Transition to IDLE
      spec transition
        signal ident Fault
        action ident reportFault
        state qual ident IDLE
      @ Transition to IDLE
      spec transition
        signal ident Complete
        state qual ident IDLE
    @ DRIVING state
    def state
      ident DRIVING
      @ Internal transition
      spec transition
        signal ident RTI
        action ident motorControl
      @ Transition to IDLE
      spec transition
        signal ident Stop
        state qual ident IDLE
    @ Transition to DEVICE_ON
    spec transition
      signal ident POR
      state qual ident DEVICE_ON
    @ Transition to j2
    spec transition
      signal ident Fault
      state qual ident j2
    @ Transition to DEVICE_OFF
    spec transition
      signal ident PowerOff
      state qual ident DEVICE_OFF
  @ Junction j2
  def junction
    ident j2
    guard ident noRecovery
    state qual ident DIAGNOSTICS
    action ident reportFault
    state qual ident RECOVERY
  @ RECOVERY state
  def state
    ident RECOVERY
    @ Internal transtition
    spec transition
      signal ident RTI
      action ident doSafe
    @ Transition to DIAGNOSTICS
    spec transition
      signal ident Complete
      state qual ident DIAGNOSTICS
  @ DIAGNOSTICS state
  def state
    ident DIAGNOSTICS
    @ Internal transition
    spec transition
      signal ident RTI
      action ident doDiagnostics
    @ Transition to DEVICE_ON
    spec transition
      signal ident Resume
      state qual ident DEVICE_ON
