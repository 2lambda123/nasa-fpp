{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "link to file in github repo?",
    "title": "FPP JSON Dictionary Schema",
    "description": "Schema for FPP JSON dictionaries",
    "type": "object",
    "$defs": {
        "typeName": {
            "type": "object",
            "properties": {
                "name": {"type": "string"},
                "kind": {"type": "string", "enum": ["integer", "float", "bool", "string", "qualifiedIdentifier"]},
                "size": {"type": "number"},
                "signed": {"type": "boolean"}
            },
            "required": ["name", "kind"]
        },
        "formalParameter": {
            "type": "object",
            "properties": {
                "name": {"type": "string"},
                "description": {"type": "string"},
                "type":  {"$ref": "#/$defs/typeName"},
                "ref": {"type": "boolean"}
            },
            "required": ["name", "description", "type", "ref"]
        }
    },
    "properties": {
        "metadata": {
            "type": "object",
            "properties": {
                "deploymentName" : {"type": "string"},
                "frameworkVersion" :  {"type": "string"},
                "projectVersion": {"type": "string"},
                "libraryVersions" : {
                    "type": "array",
                    "items": {"type": "string"}
                },
                "dictionarySpecVersion" :  {"type": "string"}
            }
        },
        "typeDefinitions":  {
            "type": "array", 
            "items": { 
                "anyOf": [
                    {
                        "type": "object",
                        "properties": {
                            "kind" : {"type": "string", "enum": ["array"]},
                            "qualifiedName" :  {"type": "string"},
                            "size": {"type": "number"},
                            "elementType" : { "$ref": "#/$defs/typeName" },
                            "default" :  {"type": "array"}
                        },
                        "required": ["kind", "qualifiedName", "size", "elementType", "default"]
                    }, 
                    {
                        "type": "object",
                        "properties": {
                            "kind" : {"type": "string", "enum": ["enum"]},
                            "qualifiedName" :  {"type": "string"},
                            "representationType": { "$ref": "#/$defs/typeName" },
                            "identifiers" : {
                                "type": "object",
                                "additionalProperties": {"type": "number"}
                            },
                            "default" : {"type": "string"}
                        },
                        "required": ["kind", "qualifiedName", "representationType", "identifiers", "default"]
                    }, 
                    {
                        "type": "object",
                        "properties": {
                            "kind" : {"type": "string", "enum": ["struct"]},
                            "qualifiedName" :  {"type": "string"},
                            "members": {
                                "type": "object",
                                "additionalProperties": {
                                    "type": "object",
                                    "properties": {
                                        "type": { "$ref": "#/$defs/typeName" },
                                        "index": {"type": "number"},
                                        "size": {"type": "number"},
                                        "format": {"type": "string"}
                                    },
                                    "required": ["type", "index"]
                                }
                            },
                            "default": {
                                "type": "object",
                                "additionalProperties": {
                                    "type": ["string", "number", "boolean", "array", "object"]
                                }
                            }
                        },
                        "required": ["kind", "qualifiedName", "members", "default"]
                    }
                ]
            }
        },
        "commands":  {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "commandKind": {"type": "string"},
                    "opcode": {"type": "number"},
                    "description": {"type": "string"},
                    "formalParams": {"type":"array", "items":  { "$ref": "#/$defs/formalParameter" }},
                    "priority": {"type": "number"},
                    "queueFullBehavior": {"type": "string", "enum": ["assert", "block", "drop"]}
                },
                "required": ["name", "commandKind", "opcode", "description", "formalParams"]
            }
        },
        "parameters": {
            "type": "array", 
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "description": {"type": "string"},
                    "type": { "$ref": "#/$defs/typeName" },
                    "default": {"type": ["number", "string", "boolean", "object", "array"]},
                    "id": {"type": "number"}
                },
                "required": ["name", "description", "type", "id"]
            }
        },
        "events":  {
            "type": "array", 
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "description": {"type": "string"},
                    "severity": {"type": "string", "enum": ["ACTIVITY_HIGH", "ACTIVITY_LOW", "COMMAND", "DIAGNOSTIC", "FATAL", "WARNING_HIGH", "WARNING_LOW"]},
                    "formalParams": {"type":"array", "items": { "$ref": "#/$defs/formalParameter" }},
                    "id": {"type": "number"},
                    "format": {"type": "string"},
                    "throttle": {"type": "number"}
                },
                "required": ["name", "description", "severity", "formalParams", "id"]
            }
        },
        "telemetryChannels":  {
            "type": "array", 
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "description": {"type": "string"},
                    "type": { "$ref": "#/$defs/typeName" },
                    "id": {"type": "number"},
                    "telemetryUpdate": {"type": "string", "enum": ["always", "on change"]},
                    "format": {"type": "string"},
                    "limit": {
                        "type": "object",
                        "properties": {
                            "high": {
                                "type": "object",
                                "properties": {
                                    "yellow": {"type": "number"},
                                    "orange": {"type": "number"},
                                    "red": {"type": "number"}
                                }
                            },
                            "low": {
                                "type": "object",
                                "properties": {
                                    "yellow": {"type": "number"},
                                    "orange": {"type": "number"},
                                    "red": {"type": "number"}
                                }
                            }
                        }
                    }
                },
                "required": ["name", "description", "type", "id", "telemetryUpdate"]
            }
        },
        "records":  {
            "type": "array", 
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "description": {"type": "string"},
                    "type": { "$ref": "#/$defs/typeName" },
                    "array": {"type": "boolean"},
                    "id": {"type": "number"}
                },
                "required": ["name", "description", "type", "id"]
            }
        },
        "containers":  { 
            "type": "array", 
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "description": {"type": "string"},
                    "id": {"type": "number"},
                    "defaultPriority": {"type": "number"}
                },
                "required": ["name", "description", "id"]
            }
        }
    }
  }
  