<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/fpp/docs/spec/Device.fpp.html</title>
<meta name="Generator" content="Vim/8.1">
<meta name="plugin-version" content="vim8.1_v1">
<meta name="syntax" content="none">
<meta name="settings" content="use_css,pre_wrap,no_foldcolumn,prevent_copy=">
<meta name="colorscheme" content="desert">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #ffffff; background-color: #000000; }
body { font-family: monospace; color: #ffffff; background-color: #000000; }
* { font-size: 1em; }
.Type { color: #008000; }
.Comment { color: #008080; }
.Identifier { color: #008080; font-weight: bold; }
.Statement { color: #804000; }
-->
</style>
</head>
<body>
<pre id='vimCodeElement'>
<span class="Comment"># Define a basic state machine event type</span>
<span class="Comment"># Only contains the required state machine ID and an event signal,</span>
<span class="Comment"># no payload data</span>
<span class="Statement">struct</span> <span class="Identifier">SMEvents</span> {
    <span class="Identifier">smId</span> : <span class="Type">U32</span>
    <span class="Identifier">eventSignal</span> : <span class="Type">U32</span>
}

<span class="Comment"># Start of the state machine definition</span>
<span class="Statement">state</span> <span class="Identifier">machine</span> <span class="Identifier">Device</span> {

    <span class="Statement">event</span> <span class="Identifier">RTI</span>: <span class="Identifier">SMEvents</span>
    <span class="Statement">event</span> <span class="Identifier">Complete</span>: <span class="Identifier">SMEvents</span>
    <span class="Statement">event</span> <span class="Identifier">Calibrate</span>: <span class="Identifier">SMEvents</span>
    <span class="Statement">event</span> <span class="Identifier">Fault</span>: <span class="Identifier">SMEvents</span>
    <span class="Statement">event</span> <span class="Identifier">Drive</span>: <span class="Identifier">SMEvents</span>
    <span class="Statement">event</span> <span class="Identifier">Stop</span>: <span class="Identifier">SMEvents</span>
    <span class="Statement">event</span> <span class="Identifier">Resume</span>: <span class="Identifier">SMEvents</span>
    <span class="Statement">event</span> <span class="Identifier">POR</span>: <span class="Identifier">SMEvents</span>

    <span class="Statement">state</span> <span class="Identifier">Off</span>

    <span class="Statement">state</span> <span class="Identifier">On</span> {

        <span class="Statement">state</span> <span class="Identifier">Initializing</span>

        <span class="Statement">state</span> <span class="Identifier">Idle</span>

        <span class="Statement">state</span> <span class="Identifier">Calibrating</span> {

            <span class="Statement">guard</span> <span class="Identifier">doCalibrate</span>: <span class="Identifier">SMEvents</span>
            <span class="Statement">internal</span> <span class="Statement">event</span> <span class="Identifier">RTI</span>
                     <span class="Statement">guard</span> <span class="Identifier">doCalibrate</span>
        }

        <span class="Statement">state</span> <span class="Identifier">Driving</span> {

            <span class="Statement">action</span> <span class="Identifier">motorControl</span>: <span class="Identifier">SMEvents</span>
            <span class="Statement">internal</span> <span class="Statement">event</span> <span class="Identifier">RTI</span>
                     <span class="Statement">action</span> <span class="Identifier">motorControl</span>
        }

        <span class="Statement">[*]</span> -&gt; <span class="Identifier">Initializing</span>

        <span class="Identifier">Initializing</span> -&gt; <span class="Identifier">Idle</span> <span class="Statement">event</span> <span class="Identifier">Complete</span>

        <span class="Identifier">Idle</span> -&gt; <span class="Identifier">Driving</span> <span class="Statement">event</span> <span class="Identifier">Drive</span>

        <span class="Statement">guard</span> <span class="Identifier">calibrateReady</span>: <span class="Identifier">SMEvents</span>
        <span class="Identifier">Idle</span> -&gt; <span class="Identifier">Calibrating</span> <span class="Statement">event</span> <span class="Identifier">Calibrate</span>
                            <span class="Statement">guard</span> <span class="Identifier">calibrateReady</span>

        <span class="Statement">action</span> <span class="Identifier">reportFault</span>: <span class="Identifier">SMEvents</span>
        <span class="Identifier">Calibrating</span> -&gt; <span class="Identifier">Idle</span> <span class="Statement">event</span> <span class="Identifier">Fault</span>
                            <span class="Statement">action</span> <span class="Identifier">reportFault</span>

        <span class="Identifier">Calibrating</span> -&gt; <span class="Identifier">Idle</span> <span class="Statement">event</span> <span class="Identifier">Complete</span>

        <span class="Identifier">Driving</span> -&gt; <span class="Identifier">Idle</span> <span class="Statement">event</span> <span class="Identifier">Stop</span>
    }

    <span class="Statement">state</span> <span class="Identifier">Recovery</span> {

        <span class="Statement">action</span> <span class="Identifier">doSafe</span>: <span class="Identifier">SMEvents</span>
        <span class="Statement">internal</span> <span class="Statement">event</span> <span class="Identifier">RTI</span>
                  <span class="Statement">action</span> <span class="Identifier">doSafe</span>
    }

    <span class="Statement">state</span> <span class="Identifier">Diagnostics</span> {

        <span class="Statement">action</span> <span class="Identifier">doDiagnostics</span>: <span class="Identifier">SMEvents</span>
        <span class="Statement">internal</span> <span class="Statement">event</span> <span class="Identifier">RTI</span>
                 <span class="Statement">action</span>: <span class="Identifier">doDiagnostics</span>
    }

    <span class="Statement">[*]</span> -&gt; <span class="Identifier">Off</span>

    <span class="Identifier">Off</span> -&gt; <span class="Identifier">On</span> <span class="Statement">event</span> <span class="Identifier">PowerOn</span>

    <span class="Identifier">On</span> -&gt; <span class="Identifier">Off</span> <span class="Statement">event</span> <span class="Identifier">PowerOff</span>

    <span class="Statement">action</span> <span class="Identifier">reportFault</span>: <span class="Identifier">SMEvents</span>
    <span class="Identifier">On</span> -&gt; <span class="Identifier">Recovery</span> <span class="Statement">event</span> <span class="Identifier">Fault</span>
                   <span class="Statement">action</span> <span class="Identifier">reportFault</span>

    <span class="Identifier">Diagnostics</span> -&gt; <span class="Identifier">On</span> <span class="Statement">event</span> <span class="Identifier">Resume</span>

    <span class="Identifier">Recovery</span> -&gt; <span class="Identifier">Diagnostics</span> <span class="Statement">event</span> <span class="Identifier">Complete</span>

    <span class="Identifier">On</span> -&gt; <span class="Identifier">On</span> <span class="Statement">event</span> <span class="Identifier">POR</span>
}
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
